<div class="p-8 max-w-7xl mx-auto">
    <!-- Header -->
    <div class="flex justify-between items-center mb-8">
        <div>
            <h1 class="text-2xl font-bold text-gray-900">Monitoring des Coûts & Usage</h1>
            <p class="text-gray-500">Vue d'ensemble de l'activité système</p>
        </div>
        <button (click)="refresh()" class="btn btn-secondary flex items-center gap-2">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path></svg>
            Refresh
        </button>
    </div>

    <!-- KPI Cards (Overview) -->
    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8" *ngIf="stats">
        <div class="card p-6">
            <h3 class="text-sm font-medium text-gray-500 uppercase tracking-wide mb-2">Total Utilisateurs</h3>
            <div class="text-3xl font-bold text-gray-900">{{ stats.total_users }}</div>
        </div>
        <div class="card p-6">
            <h3 class="text-sm font-medium text-gray-500 uppercase tracking-wide mb-2">Appels API</h3>
            <div class="text-3xl font-bold text-gray-900">{{ stats.total_logs }}</div>
        </div>
        <div class="card p-6">
            <h3 class="text-sm font-medium text-gray-500 uppercase tracking-wide mb-2">Recommendations</h3>
            <div class="text-3xl font-bold text-gray-900">{{ stats.total_recommendations }}</div>
        </div>
    </div>

    <!-- Tabs -->
    <div class="flex border-b border-gray-200 mb-6">
        <button (click)="setTab('overview')" class="px-6 py-3 font-medium text-sm transition-colors border-b-2" 
            [ngClass]="activeTab === 'overview' ? 'border-primary text-primary' : 'border-transparent text-gray-500 hover:text-gray-700'">
            Overview
        </button>
        <button (click)="setTab('logs')" class="px-6 py-3 font-medium text-sm transition-colors border-b-2"
            [ngClass]="activeTab === 'logs' ? 'border-primary text-primary' : 'border-transparent text-gray-500 hover:text-gray-700'">
            Logs
        </button>
        <button (click)="setTab('users')" class="px-6 py-3 font-medium text-sm transition-colors border-b-2"
            [ngClass]="activeTab === 'users' ? 'border-primary text-primary' : 'border-transparent text-gray-500 hover:text-gray-700'">
            Users
        </button>
    </div>

    <!-- Tab Content -->
    
    <!-- Overview Detail -->
    <div *ngIf="activeTab === 'overview' && stats">
        <div class="card overflow-hidden">
            <table class="w-full text-sm text-left">
                <thead class="bg-gray-50 text-gray-500">
                    <tr>
                        <th class="px-6 py-3 font-medium">Endpoint</th>
                        <th class="px-6 py-3 font-medium">Call Count</th>
                        <th class="px-6 py-3 font-medium">Avg Duration (ms)</th>
                    </tr>
                </thead>
                <tbody class="divide-y divide-gray-100">
                    <tr *ngFor="let stat of stats.endpoint_stats">
                        <td class="px-6 py-3">{{ stat.endpoint }}</td>
                        <td class="px-6 py-3">{{ stat.count }}</td>
                        <td class="px-6 py-3">{{ stat.avg_duration_ms }}</td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>

    <!-- Logs -->
    <div *ngIf="activeTab === 'logs'">
        <div class="card overflow-hidden">
            <table class="w-full text-sm text-left">
                <thead class="bg-gray-50 text-gray-500">
                    <tr>
                        <th class="px-6 py-3 font-medium">Time</th>
                        <th class="px-6 py-3 font-medium">Endpoint</th>
                        <th class="px-6 py-3 font-medium">Duration</th>
                        <th class="px-6 py-3 font-medium">Status</th>
                    </tr>
                </thead>
                <tbody class="divide-y divide-gray-100">
                    <tr *ngFor="let log of logs">
                        <td class="px-6 py-3 text-gray-500">{{ formatDate(log.created_at) }}</td>
                        <td class="px-6 py-3 font-mono text-xs">{{ log.endpoint }}</td>
                        <td class="px-6 py-3">{{ log.duration_ms }}ms</td>
                        <td class="px-6 py-3">
                            <span class="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium"
                                [ngClass]="log.error ? 'bg-red-100 text-red-800' : 'bg-green-100 text-green-800'">
                                {{ log.error ? 'Error' : 'Success' }}
                            </span>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>

    <!-- Users -->
    <div *ngIf="activeTab === 'users'">
        <div class="card overflow-hidden">
            <table class="w-full text-sm text-left">
                <thead class="bg-gray-50 text-gray-500">
                    <tr>
                        <th class="px-6 py-3 font-medium">Email</th>
                        <th class="px-6 py-3 font-medium">Created</th>
                        <th class="px-6 py-3 font-medium">Logs</th>
                        <th class="px-6 py-3 font-medium">Recs</th>
                        <th class="px-6 py-3 font-medium">Role</th>
                    </tr>
                </thead>
                <tbody class="divide-y divide-gray-100">
                    <tr *ngFor="let user of users">
                        <td class="px-6 py-3 font-medium">{{ user.email }}</td>
                        <td class="px-6 py-3 text-gray-500">{{ formatDate(user.created_at) }}</td>
                        <td class="px-6 py-3">{{ user.total_logs }}</td>
                        <td class="px-6 py-3">{{ user.total_recommendations }}</td>
                        <td class="px-6 py-3">
                            <span *ngIf="user.is_admin" class="bg-purple-100 text-purple-800 px-2 py-0.5 rounded text-xs font-bold">ADMIN</span>
                            <span *ngIf="!user.is_admin" class="text-gray-400">User</span>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>

</div>

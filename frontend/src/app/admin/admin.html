<div class="admin-container">
    <div class="admin-header">
        <h1>Admin Dashboard</h1>
        <button class="refresh-btn" (click)="refresh()">ðŸ”„ Refresh</button>
    </div>

    <div class="tabs">
        <button class="tab" [class.active]="activeTab === 'overview'" (click)="setTab('overview')">
            Overview
        </button>
        <button class="tab" [class.active]="activeTab === 'logs'" (click)="setTab('logs')">
            Logs
        </button>
        <button class="tab" [class.active]="activeTab === 'users'" (click)="setTab('users')">
            Users
        </button>
        <button class="tab" [class.active]="activeTab === 'recommendations'" (click)="setTab('recommendations')">
            Recommendations
        </button>
    </div>

    <!-- Overview Tab -->
    <div *ngIf="activeTab === 'overview'" class="tab-content">
        <div *ngIf="loading.stats" class="loading">Loading stats...</div>
        <div *ngIf="!loading.stats && stats" class="stats-grid">
            <div class="stat-card">
                <h3>Total Users</h3>
                <p class="stat-value">{{ stats.total_users }}</p>
            </div>
            <div class="stat-card">
                <h3>Total API Calls</h3>
                <p class="stat-value">{{ stats.total_logs }}</p>
            </div>
            <div class="stat-card">
                <h3>Recommendations</h3>
                <p class="stat-value">{{ stats.total_recommendations }}</p>
            </div>
        </div>

        <div *ngIf="!loading.stats && stats && stats.endpoint_stats.length > 0" class="endpoint-stats">
            <h2>Endpoint Usage</h2>
            <table>
                <thead>
                    <tr>
                        <th>Endpoint</th>
                        <th>Call Count</th>
                        <th>Avg Duration (ms)</th>
                    </tr>
                </thead>
                <tbody>
                    <tr *ngFor="let stat of stats.endpoint_stats">
                        <td>{{ stat.endpoint }}</td>
                        <td>{{ stat.count }}</td>
                        <td>{{ stat.avg_duration_ms }}</td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>

    <!-- Logs Tab -->
    <div *ngIf="activeTab === 'logs'" class="tab-content">
        <h2>Recent API Logs</h2>
        <div *ngIf="loading.logs" class="loading">Loading logs...</div>
        <div *ngIf="!loading.logs && logs.length === 0" class="empty-state">
            No logs yet. Make some API calls to see them here!
        </div>
        <table *ngIf="!loading.logs && logs.length > 0">
            <thead>
                <tr>
                    <th>Time</th>
                    <th>Endpoint</th>
                    <th>Duration (ms)</th>
                    <th>Status</th>
                </tr>
            </thead>
            <tbody>
                <tr *ngFor="let log of logs" [class.error]="log.error">
                    <td>{{ formatDate(log.created_at) }}</td>
                    <td>{{ log.endpoint }}</td>
                    <td>{{ log.duration_ms }}</td>
                    <td>
                        <span *ngIf="!log.error" class="status-success">âœ“ Success</span>
                        <span *ngIf="log.error" class="status-error">âœ— Error</span>
                    </td>
                </tr>
            </tbody>
        </table>
    </div>

    <!-- Users Tab -->
    <div *ngIf="activeTab === 'users'" class="tab-content">
        <h2>Users</h2>
        <div *ngIf="loading.users" class="loading">Loading users...</div>
        <div *ngIf="!loading.users && users.length === 0" class="empty-state">
            No users yet.
        </div>
        <table *ngIf="!loading.users && users.length > 0">
            <thead>
                <tr>
                    <th>Email</th>
                    <th>Created</th>
                    <th>Total Logs</th>
                    <th>Recommendations</th>
                    <th>Admin</th>
                </tr>
            </thead>
            <tbody>
                <tr *ngFor="let user of users">
                    <td>{{ user.email }}</td>
                    <td>{{ formatDate(user.created_at) }}</td>
                    <td>{{ user.total_logs }}</td>
                    <td>{{ user.total_recommendations }}</td>
                    <td>{{ user.is_admin ? 'âœ“' : '' }}</td>
                </tr>
            </tbody>
        </table>
    </div>

    <!-- Recommendations Tab -->
    <div *ngIf="activeTab === 'recommendations'" class="tab-content">
        <h2>Recent Recommendations</h2>
        <div *ngIf="loading.recommendations" class="loading">Loading recommendations...</div>
        <div *ngIf="!loading.recommendations && recommendations.length === 0" class="empty-state">
            No recommendations yet.
        </div>
        <div *ngIf="!loading.recommendations && recommendations.length > 0" class="recommendations-list">
            <div *ngFor="let rec of recommendations" class="recommendation-card">
                <div class="rec-header">
                    <span class="rec-date">{{ formatDate(rec.created_at) }}</span>
                    <span class="rec-tasks">{{ rec.tasks_count }} tasks</span>
                </div>
                <p class="rec-text">{{ rec.recommendation_text }}</p>
            </div>
        </div>
    </div>
</div>